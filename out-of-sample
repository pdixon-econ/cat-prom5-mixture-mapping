
clear

/*
This file describes how to obtain predicted values of EQ-5D when using the Cat-PROM5 mapping algorithm
The file is based on the out of sample prediction file provided in:
Gray LA, Wailoo AJ, Hernandez Alava M. Mapping the FACT-B Instrument to EQ-5D-3L in Patients with Breast Cancer Using Adjusted Limited Dependent Variable Mixture Models versus Response Mapping. Value in Health. 2018; 21: 1399-405
https://doi.org/10.1016/j.jval.2018.06.006

The mapping algorithm requires information on age (coded in years), sex (binary, coded as 0=male 1=Female. ), diabetic status (binary, coded as 0=non-diabetic, 1=diabetic) and the Cat-PROM5 index score
In Step 1, users should upload their own dataset containing (at least) these variables
In Step 2, users should upload the estimates created from the mapping algorithm contained in the .ster files provided as supplementary material
In Step 3, users may calculate expected values given the characteristics of patients in their own dataset
NotS that the predictions calculate the mean of the target outcome variable (e.g. EQ-5D-5L), conditional on the covariate values in the data provided to the algorithm.
In step 4, users may calculate standard errors  

*/

*STEP 1 - Load data on which predictions are to be generated


use economic_analysis.dta, clear 


/**************************************************************************/

*STEP 2 - Load the estimates generated by the published mapping algorithm

estimates use "ALDVMMeq5d5l_b.ster"

*STEP 3 - Form predictions

predict Ey, outcome(all)

summ Ey*

*STEP 4 - Calculate standard errors 

// Define local macro to support calculation of standard errors - since "margins" is a post estimation command, we need to use esample to define the estimation sample. 
local xvars "catprom_b age sex diabetic"

estimates use "ALDVMMeq5d5l_b.ster"

estimates esample: `xvars' 
margins

